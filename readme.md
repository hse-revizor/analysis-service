# Сервис анализа

Этот сервис предоставляет API для хранения данных об анализах и результатах выполнения правил.

## Описание сущностей

### Analyze (Анализ)

| Поле          | Тип                  | Описание                                           |
|---------------|----------------------|---------------------------------------------------|
| `Id`          | `uuid.UUID`          | Уникальный идентификатор анализа (первичный ключ) |
| `ProjectId`   | `uuid.UUID`          | Идентификатор проекта                             |
| `Status`      | `string`             | Статус выполнения анализа                         |
| `RulesetId`   | `uuid.UUID`          | Идентификатор набора правил                       |
| `RuleResults` | `[]AnalyzeRuleResult`| Результаты выполнения правил                      |
| `StartedAt`   | `*time.Time`         | Время начала анализа                              |
| `FinishedAt`  | `*time.Time`         | Время завершения анализа                          |
| `CreatedAt`   | `*time.Time`         | Время создания записи                             |
| `UpdatedAt`   | `*time.Time`         | Время последнего обновления записи                |

### AnalyzeRuleResult (Результат правила анализа)

| Поле        | Тип         | Описание                                                |
|-------------|-------------|--------------------------------------------------------|
| `Id`        | `uuid.UUID` | Уникальный идентификатор результата (первичный ключ)   |
| `AnalyzeId` | `uuid.UUID` | Идентификатор анализа                                  |
| `RuleId`    | `uuid.UUID` | Идентификатор правила                                  |
| `Status`    | `string`    | Статус выполнения правила (passed, failed, skipped)    |
| `Details`   | `string`    | Детали выполнения правила                              |
| `CreatedAt` | `*time.Time`| Время создания записи                                  |
| `UpdatedAt` | `*time.Time`| Время последнего обновления записи                     |

## Используемые технологии

*   **Язык программирования:** Go
*   **База данных:** PostgreSQL
*   **HTTP-роутер:** Gin-gonic
*   **ORM:** GORM
*   **Генерация документации:** Swaggo

## Запуск приложения

### Требования

*   Установленный Go (версия 1.18 или выше)
*   Установленный PostgreSQL
*   Настроенное подключение к базе данных PostgreSQL (см. `config.yaml`)

### Команды Makefile

*   **`run-dev`**: Запускает приложение в режиме разработки.
    *   Использует конфигурационный файл `config.yaml`.
    *   Устанавливает переменную окружения `env-mode` в `development`.
*   **`swag`**: Генерирует документацию API с помощью Swaggo.
    *   `--parseDependency`: Включает парсинг зависимостей.
    *   `--parseInternal`: Включает парсинг внутренних пакетов.
    *   `--parseDepth 3`: Устанавливает глубину парсинга зависимостей на 3 уровня.
    *   `-g cmd/service/main.go`: Указывает главный файл приложения.

## Конфигурация

Конфигурация приложения осуществляется через переменные окружения:

```env
# Настройки сервера
PORT=8080              # Порт, на котором запускается сервис
HOST=localhost         # Хост сервиса

# Настройки базы данных
DB_HOST=localhost      # Хост базы данных
DB_PORT=5432          # Порт базы данных
DB_USER=postgres      # Пользователь базы данных
DB_NAME=analysis         # Название базы данных
DB_PASSWORD=password  # Пароль для пользователя базы данных
DB_SSL_MODE=disable   # Тип SSL-соединения (disable, require, verify-ca, verify-full)
```

### Запуск в режиме разработки

1.  **Настройте подключение к базе данных:**
    *   Создайте базу данных PostgreSQL.
    *   Установите необходимые переменные окружения (можно использовать `.env` файл).
2.  **Запустите приложение:**

    ```bash
    make run-dev
    ```
    Сервис будет доступен по адресу `http://localhost:8080` (или на порту, указанном в переменной окружения `PORT`).

## Документация API

Документация API генерируется автоматически с помощью Swaggo и доступна по адресу `http://localhost:8080/swagger/index.html` (после запуска приложения и выполнения `make swag`).

## Функциональность

Сервис предоставляет следующие возможности:

*   **Управление анализами:**
    * Создание новых анализов с привязкой к проекту и набору правил
    * Получение списка анализов с возможностью фильтрации по проекту
    * Получение конкретного анализа по ID
    * Отслеживание статуса выполнения анализа
    * Просмотр времени начала и завершения анализа

*   **Управление результатами правил:**
    * Создание результатов для каждого правила в анализе
    * Получение списка результатов для конкретного анализа
    * Просмотр деталей выполнения каждого правила
    * Отслеживание статуса выполнения правил (passed, failed, skipped)

## Внесение изменений

При изменении модели данных (`analyze`) или API необходимо:

1.  Обновить структуру `analyze` в коде.
2.  Обновить миграции базы данных, если необходимо.
3.  Обновить документацию API, выполнив команду `make swag`.

## Примечание
* Замените порт `8080`